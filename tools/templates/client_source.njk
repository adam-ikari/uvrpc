/**
 * Auto-generated client source file for {{ serviceName }}
 * Generated from {{ yamlPath }}
 * Do not edit this file manually
 */

#include "{{ serviceName | lower }}_gen_client.h"
#include "{{ serviceName | lower }}_gen.h"
#include <stdlib.h>
#include <string.h>

{% for method in methods %}

/* ==================== {{ method.name }} Client API ==================== */

int {{ functionName(serviceName, method.name, 'CallAsync') }}(
    uvrpc_client_t* client,
    const {{ structName(serviceName, method.name, 'Request') }}_t* request,
    {{ structName(serviceName, method.name, 'Response') }}_t* response,
    uv_loop_t* loop
) {
    return uvrpc_client_call_sync_optimized(
        client,
        "{{ serviceName }}.{{ method.name }}",
        "{{ method.name }}",
        request,
        (uvrpc_serialize_func_t){{ functionName(serviceName, method.name, 'SerializeRequest') }},
        response,
        (uvrpc_deserialize_func_t){{ functionName(serviceName, method.name, 'DeserializeResponse') }},
        loop
    );
}

int {{ functionName(serviceName, method.name, 'Async') }}(
    uvrpc_client_t* client,
    const {{ structName(serviceName, method.name, 'Request') }}_t* request,
    uvrpc_async_t* async
) {
    return uvrpc_client_call_async_optimized(
        client,
        "{{ serviceName }}.{{ method.name }}",
        "{{ method.name }}",
        request,
        (uvrpc_serialize_func_t){{ functionName(serviceName, method.name, 'SerializeRequest') }},
        async
    );
}

int {{ functionName(serviceName, method.name, 'AsyncTimeout') }}(
    uvrpc_client_t* client,
    const {{ structName(serviceName, method.name, 'Request') }}_t* request,
    uvrpc_async_t* async,
    uint64_t timeout_ms
) {
    (void)timeout_ms; /* Timeout is handled in uvrpc_async_await_timeout */
    return {{ functionName(serviceName, method.name, 'Async') }}(client, request, async);
}

int {{ functionName(serviceName, method.name, 'Await') }}(
    const uvrpc_async_result_t* result,
    {{ structName(serviceName, method.name, 'Response') }}_t* response
) {
    if (!result || !response) {
        return UVRPC_ERROR_INVALID_PARAM;
    }

    if (result->status != UVRPC_OK) {
        return result->status;
    }

    /* Deserialize response */
    if ({{ functionName(serviceName, method.name, 'DeserializeResponse') }}(
            result->response_data, result->response_size, response) != 0) {
        return UVRPC_ERROR;
    }

    return UVRPC_OK;
}

{% endfor %}