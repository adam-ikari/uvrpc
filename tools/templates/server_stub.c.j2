/* Auto-generated by UVRPC DSL Generator - DO NOT EDIT MANUALLY */
#include "{{ schema_basename|lower }}_reader.h"
#include "{{ schema_basename|lower }}_builder.h"
#include "{{ namespace|lower }}_{{ service_name_lower }}_api.h"
#include <stdio.h>
#include <string.h>

/* Generic RPC handler (reused for all methods in this service) */
static void uvrpc_{{ service_name_lower }}_handler(uvrpc_request_t* req, void* ctx) {
    const char* method_name = req->method;
    
    /* Parse request using FlatBuffers */
    void* request = NULL;
    if (req->params && req->params_size > 0) {
        request = (void*)req->params;
    }
    
    if (!request) {
        uvrpc_request_send_response(req, UVRPC_ERROR_INVALID_PARAM, NULL, 0);
        return;
    }
    
    /* Call user-implemented handler */
    uvrpc_error_t result = uvrpc_{{ service_name_lower }}_handle_request(method_name, request, req);
    
    if (result != UVRPC_OK) {
        uvrpc_request_send_response(req, result, NULL, 0);
    }
}

/* Create {{ service.name }} server */
uvrpc_server_t* uvrpc_{{ service_name_lower }}_create_server(uv_loop_t* loop, const char* address, void* user_context) {
    uvrpc_config_t* config = uvrpc_config_new();
    uvrpc_config_set_loop(config, loop);
    uvrpc_config_set_address(config, address);
    
    uvrpc_server_t* server = uvrpc_server_create(config);
    
    /* Register all service handlers with user context */
{% for method in service.methods -%}
    uvrpc_server_register(server, "{{ method.name }}", uvrpc_{{ service_name_lower }}_handler, user_context);
{% endfor -%}
    
    return server;
}

/* Start {{ service.name }} server */
uvrpc_error_t uvrpc_{{ service_name_lower }}_start_server(uvrpc_server_t* server) {
    return uvrpc_server_start(server);
}

/* Stop {{ service.name }} server */
void uvrpc_{{ service_name_lower }}_stop_server(uvrpc_server_t* server) {
    uvrpc_server_stop(server);
}

/* Free {{ service.name }} server */
void uvrpc_{{ service_name_lower }}_free_server(uvrpc_server_t* server) {
    uvrpc_server_free(server);
}